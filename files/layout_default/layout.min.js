var waiting_for_response=!1,force_button_disable=!1,buttons_disabled=!1;function loadPage(url=null,target="all",data=null,method="post",hide=!1){if(buttons_disabled)console.log("buttons paused");else{if(console.log("loading..."),null==url?url=window.location.href.replace(/&act=wake|&act=sleep|&act=gather|&act=equip|&act=delete|&process=split|&process=merge|&process=take_out|&forget=\d*|&start=\d*|&quit=\d*|&track=\d*|&invID=\d*|&turn_in=\d*|&dialog_option=[^&]*/gi,""):history.pushState(null,null,url),null!=data&&"string"===$.type(data)?(tempData=data.split(","),data={},$.each(tempData,function(e,t){moreTempData=t.split(":"),data[moreTempData[0]]=moreTempData[1]}),hide||(data.ajaxRequest="yes")):hide||(data={},data.ajaxRequest="yes"),"all"==target&&(target="#page-wrapper-2"),"get"==method);else if("post"==method){waiting_for_response=!0,$(target).load(url+" "+target,data,function(response){enableButtons();var response_temp=response.split("<!DOCTYPE"),error=response_temp[0];if(response_temp=response_temp.splice(1),response="",response_temp.forEach(function(e){response=response+"<!DOCTYPE"+e}),error.length>0&&(console.log(error),alert(error)),$(target).children(":first").unwrap(),0==$("#page-wrapper-2").length&&$("#page-wrapper-1").children().wrapAll('<div id="page-wrapper-2" />'),waiting_for_response=!1,manageScrollBars(),"function"==typeof summary_script&&summary_script(),$(response).find("#confirm_popups").length&&eval($(response).find("#confirm_popups")[0].innerHTML),$(response).find("#BattlePageJS").length&&(!("timer"in window)||!timer))var battle_page_fix=setInterval(function(){if(!$(response).find("#BattlePageJS").length||"timer"in window&&timer&&"undefined"!=typeof pageInit)pageInit;else{var e=$(response).find("#the_id")[0].outerHTML;$("body").append(e),e=$(response).find("#BattlePageJS")[0].outerHTML,$("body").append(e),clearInterval(battle_page_fix),pageInit()}},50);$(response).closest("#key_bindings").length&&(resetMouseTrap(),eval($(response).closest("#key_bindings")[0].innerHTML)),loadAds(),$(response).find("#pageScript").length&&eval($(response).find("#pageScript")[0].innerHTML),console.log("...finished")}),force_button_disable=!0,disableButtons(),i=0;var release_buttons=setInterval(function(e=0){!waiting_for_response&&e<4&&(force_button_disable=!1,enableButtons(),clearInterval(release_buttons)),e+=1},50)}disableButtons(),setTimeout(function(){$("[title]").colorTip(),"function"==typeof setUpTerritoryMap&&setUpTerritoryMap()},500)}}async function loadAds(){$time_cookie=getCookie("adTimer"),(null==$time_cookie||$time_cookie<Date.now()-10)&&(setCookie("adTimer",Date.now()),(adsbygoogle=window.adsbygoogle||[]).push({}))}function disableButtons(){buttons_disabled=!0}function enableButtons(){disableButtons(),force_button_disable||(buttons_disabled=!1)}if("undefined"==typeof variable)var timers=[];function tickTimer(e){if(!timers.includes(e)){if(timers.push(e),!$("#"+e).length)return!1;if("n/a"==$("#"+e).data("timer-seconds"))return"Show"==$("#"+e).data("show")&&$("#"+e).html("n/a"),!1;var t=Math.round((new Date).getTime()/1e3),o=parseInt($("#"+e).data("timer-seconds")),a=t+o,n=Math.floor(o/86400).toString(),i=Math.floor((o-86400*n)/3600).toString(),r=Math.floor((o-86400*n-3600*i)/60).toString(),l=(o-86400*n-3600*i-60*r).toString();if(null!=$("#"+e).data("refresh")&&"updateProfile"==$("#"+e).data("refresh")){$regen=parseInt($("#"+e).data("regen"));var s=setInterval(function(){var e=$("#widget-user-details-health-text").text().split("/"),t=$("#widget-user-details-chakra-text").text().split("/"),o=$("#widget-user-details-stamina-text").text().split("/"),a={health:{new:Math.floor(parseInt(e[0])+$regen),max:Math.floor(parseInt(e[1]))},chakra:{new:Math.floor(parseInt(t[0])+$regen),max:Math.floor(parseInt(t[1]))},stamina:{new:Math.floor(parseInt(o[0])+$regen),max:Math.floor(parseInt(o[1]))}};for(var n in a)if(a.hasOwnProperty(n)){var i=a[n];i.max<i.new&&(i.new=i.max),$("#widget-user-details-"+n+"-text").text(i.new+" / "+i.max),$("#widget-user-details-"+n+"-fill").css("width",Math.floor(i.new/i.max*100)+"px")}},1e3)}else"Show"==$("#"+e).data("show")&&(n<1&&i<1&&r<1?$("#"+e).html(l+"s"):n<1&&i<1?$("#"+e).html(r+"m : "+l+"s"):n<1?$("#"+e).html(i+"h : "+r+"m : "+l+"s"):$("#"+e).html(n+"d : "+i+"h : "+r+"m : "+l+"s")),$("#"+e).data("active","yes"),o>1&&(s=setInterval(function(){$("#"+e).data("active","yes"),o=a-Math.round((new Date).getTime()/1e3);var t=Math.floor(o/86400).toString(),n=Math.floor((o-86400*t)/3600).toString(),i=Math.floor((o-86400*t-3600*n)/60).toString(),r=(o-86400*t-3600*n-60*i).toString();"Show"==$("#"+e).data("show")&&(t<1&&n<1&&i<1?$("#"+e).html(r+"s"):t<1&&n<1?$("#"+e).html(i+"m : "+r+"s"):t<1?$("#"+e).html(n+"h : "+i+"m : "+r+"s"):$("#"+e).html(t+"d : "+n+"h : "+i+"m : "+r+"s")),o<=.99999999&&(clearInterval(s),"function"==typeof window[$("#"+e).data("callback")]?window[$("#"+e).data("callback")].apply(null,null):window.location.href.includes("?id=86&")?window.location.href=window.location.href.split("&").slice(0,2).join("&"):window.location.href=window.location.href)},1e3)),o<1&&("function"==typeof window[$("#"+e).data("callback")]?window[$("#"+e).data("callback")].apply(null,null):window.location.href.includes("?id=86&")?window.location.href=window.location.href.split("&").slice(0,2).join("&"):window.location.href=window.location.href)}}function manageScrollBars(){var e,t;$("#left-bar").scrollTop(getCookie("left-bar-scroll-top")),$("#right-bar").scrollTop(getCookie("right-bar-scroll-top")),$("#left-bar").scroll(function(t){e&&clearTimeout(e),e=setTimeout(function(){setCookie("left-bar-scroll-top",t.target.scrollTop)},100)}),$("#right-bar").scroll(function(e){t&&clearTimeout(t),t=setTimeout(function(){setCookie("right-bar-scroll-top",e.target.scrollTop)},100)})}function refreshPage(){window.location.href.includes("?id=86&")?window.location.href=window.location.href.split("&").slice(0,2).join("&"):window.location.href=window.location.href}function doNothing(){}function setCookie(e,t,o){var a="";if(o){var n=new Date;n.setTime(n.getTime()+24*o*60*60*1e3),a="; expires="+n.toUTCString(),console.log("Set expiration date: "+n.toUTCString())}document.cookie=e+"="+(t||"")+a+"; path=/"}function getCookie(e){var t=("; "+document.cookie).split("; "+e+"=");if(2==t.length)return t.pop().split(";").shift()}function autoUpdateChat(){}$(window).on("load",function(){$(document).on("click","#ui-button-top-right",function(){$("#right-bar").hasClass("active")?($("#right-bar").removeClass("active"),$("#ui-button-top-right").removeClass("active"),$("#widget-notifications-floating-counter").fadeIn(),$("body").hasClass("menu-open-right")&&($("body").removeClass("menu-open-right"),$("#center-bar").removeClass("menu-open")),setCookie("right-bar-open",!1)):($("#right-bar").addClass("active"),$("#ui-button-top-right").addClass("active"),$("#widget-notifications-floating-counter").hide(),$(window).width()>500&&($("body").addClass("menu-open-right"),$("#center-bar").addClass("menu-open"),setCookie("right-bar-open",!0),setCookie("left-bar-open",!1))),$("body").removeClass("menu-open-left"),$("#left-bar").hasClass("active")&&($("#left-bar").toggleClass("active"),$("#ui-button-top-left").toggleClass("active"),setCookie("left-bar-open",!1))}),$(document).on("click","#ui-button-top-left",function(){$("#left-bar").hasClass("active")?($("#left-bar").removeClass("active"),$("#ui-button-top-left").removeClass("active"),$("body").hasClass("menu-open-left")&&($("body").removeClass("menu-open-left"),$("#center-bar").removeClass("menu-open")),setCookie("left-bar-open",!1)):($("#left-bar").addClass("active"),$("#ui-button-top-left").addClass("active"),$(window).width()>500&&($("body").addClass("menu-open-left"),$("#center-bar").addClass("menu-open"),setCookie("left-bar-open",!0),setCookie("right-bar-open",!1))),$("body").removeClass("menu-open-right"),$("#right-bar").hasClass("active")&&($("#right-bar").toggleClass("active"),$("#ui-button-top-right").toggleClass("active"),setCookie("right-bar-open",!1))}),["notifications","quests","side-menu","user-portrait","user-details","travel","quick-links"].forEach(function(e){$(document).on("click","#widget-"+e+"-title",function(t){t.originalEvent.target.id.endsWith("title")&&($("#widget-"+e+"-title").toggleClass("closed"),$("#widget-"+e+"-content").slideToggle(),$("#widget-"+e+"-title").hasClass("closed")?setCookie("widget-"+e+"-closed",!0):setCookie("widget-"+e+"-closed",!1))})}),$(document).on("click","#widget-side-menu .side-menu-button",function(e){if($("#widget-side-menu-content #side-menu-"+$("#"+e.target.id).data("menu")+"-box").hasClass("active"))return!1;$(".side-menu-type-box.active").removeClass("active"),$("#widget-side-menu-content #side-menu-"+$("#"+e.target.id).data("menu")+"-box").addClass("active"),setCookie("menu-open-tab",$("#"+e.target.id).data("menu"))}),$(document).on("click","#widget-top-menu .top-menu-button",function(e){if($("#widget-top-menu #top-menu-"+$("#"+e.target.id).data("menu")+"-box").hasClass("active"))return!1;$(".top-menu-type-box.active").removeClass("active"),$("#widget-top-menu #top-menu-"+$("#"+e.target.id).data("menu")+"-box").addClass("active"),setCookie("menu-open-tab",$("#"+e.target.id).data("menu"))}),$(document).on("click",".mobile-menu-button",function(e){if($("#widget-mobile-menu #mobile-menu-"+$("#"+e.target.id).data("menu")+"-box").hasClass("active"))return!1;$(".mobile-menu-type-box.active").removeClass("active"),$("#mobile-menu-"+$("#"+e.target.id).data("menu")+"-box").addClass("active"),setCookie("menu-open-tab",$("#"+e.target.id).data("menu"))}),$(document).on("click","#ui-button-bottom-right",function(){$("#widget-mobile-menu").fadeToggle(250),$("#ui-button-bottom-right").toggleClass("active")}),$(document).on("click","#ui-button-bottom-left",function(){$("#widget-popup-travel-wrapper").fadeToggle(250),$("#ui-button-bottom-left").toggleClass("active"),$("#ui-button-bottom-left").hasClass("active")?setCookie("widget-popup-travel-open",!0):setCookie("widget-popup-travel-open",!1)}),$(document).on("click","#ui-button-bottom-center",function(){$("#widget-popup-quick-links-wrapper").fadeToggle(250),$("#ui-button-bottom-center").toggleClass("active")}),$(document).on("click",".toggle-button-info, .toggle-button-drop",function(e){e.stopPropagation(),$(e.currentTarget).toggleClass("closed"),"#"!=$(e.currentTarget).data("target").charAt(0)&&"."!=$(e.currentTarget).data("target").charAt(0)?$("#"+$(e.currentTarget).data("target")).toggleClass("closed"):$($(e.currentTarget).data("target")).toggleClass("closed")}),$(document).on("click",".table-legend, .table-legend-mobile",function(e){var t=e.target.parentElement,o=0;$(e.target.classList).each(function(e,t){t.startsWith("column-")&&(o=t)}),"up"==$(e.target).data("direction")?$("."+o+".table-legend, ."+o+".table-legend-mobile").data("direction","down"):$("."+o+".table-legend, ."+o+".table-legend-mobile").data("direction","up");var a;a="up"==$(e.target).data("direction")?1:-1;var n={};$("."+o).not(".table-legend").not(".table-legend-mobile").not(".page-pages").not("table-footer").each(function(e,t){var o="";for($(t.classList).each(function(e,t){t.startsWith("row-")&&(o=t)});void 0!==t.children[0]&&null!==t.children[0];)t=t.children[0];n[o]=t.textContent.replace(/[^0-9a-z]/gi,"").toLowerCase()});var i=Object.keys(n).sort(function(e,t){return n[e]<n[t]?1:n[e]>n[t]?-1:0}),r=$(t).find("div").not(".table-legend").not(".page-pages").not(".table-footer");r.sort(function(e,t){aColumn="",bColumn="",aRow="",bRow="",$(e.classList).each(function(e,t){t.startsWith("row-")&&(aRow=t),t.startsWith("column-")&&(aColumn=t)}),$(t.classList).each(function(e,t){t.startsWith("row-")&&(bRow=t),t.startsWith("column-")&&(bColumn=t)});var o=0;if(aRow==bRow){if(aColumn>bColumn)return 1;if(aColumn<bColumn)return-1}else $(i).each(function(e,t){return t==aRow?(o=a,!1):t==bRow?(o=-1*a,!1):void 0});return o}),$lastRow="nope",$toggle="table-alternate-2",$(r).each(function(e,o){$(o).removeClass("table-alternate-1"),$(o).removeClass("table-alternate-2"),$(o).hasClass($lastRow)||($(o.classList).each(function(e,t){t.startsWith("row-")&&($lastRow=t)}),"table-alternate-2"==$toggle?$toggle="table-alternate-1":$toggle="table-alternate-2"),$(o).hasClass("table-legend")||$(o).addClass($toggle),$(o).appendTo(t)}),$(".page-pages").appendTo(t),$(".table-footer").appendTo(t)}),manageScrollBars(),$(".count-down").each(function(e,t){tickTimer(t.attributes.id.nodeValue)}),setInterval(function(){$(".count-down").each(function(e,t){"yes"!=$(t).data("active")&&setTimeout(function(){"yes"!=$(t).data("active")&&tickTimer(t.attributes.id.nodeValue)},2e3)})},250),$.each($(".scroll-to-bottom"),function(e,t){$(t).scrollTop($(t)[0].scrollHeight-$(t)[0].clientHeight)}),$("textarea").on("keyup",function(e){var t=e.target.maxLength;if(e.target.value.length>t)return!1;t-e.target.value.length<=.75*t?($(e.target.parentElement).find(".textAreaCounter").html("("+e.target.value.length+"/"+t+")"),$(e.target.parentElement).find("textarea").addClass("active")):($(e.target.parentElement).find(".textAreaCounter").html(""),$(e.target.parentElement).find("textarea").removeClass("active"))})});